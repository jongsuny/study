<import src="carttemplate.wxml" />
<import src='../../components/toast/toast.wxml' />
<template is="toast" data="{{...toastData}}"></template>
<!-- NOT LOGIN -->
<view wx:if="{{!isLogined}}" class="shp-cart-empty" style="display:{{isLogined?'none':'block'}}">
    <text class="cart-empty-icn"></text>
    <text class="empty-msg">{{objTextMain.loginInfoTxt}}</text>
    <text bindtap="toLogin" class="to-login-see-btn">{{objTextMain.loginTxt}}</text>
</view>

<scroll-view scroll-y="false" class="whole-page" style="height:{{screenHeight}}px;" scroll-top="{{scrollTop}}" bindscroll="listScroll">
    <!-- EMPTY CART -->
    <block wx:if="{{isCartEmpty}}">
        <view class="shp-cart-empty" style="display:block">
            <text class="cart-empty-icn"></text>
            <text class="empty-msg">{{objTextMain.emptyTxt}}</text>
        </view>
    </block>
    <!-- NOT EMPTY CART -->
    <block wx:else>
        <view class="shop-group">
            <block wx:for="{{vendors}}" wx:for-item="vendor" wx:key="shopFor">
                <view class="shop-group-item" id="shop{{vendor.shopId}}" data-vendorid="{{vendor.shopId}}">
                    <!-- the header of shop begin-->
                    <view class="shop-title customize-shtit">
                        <view class="item">
                            <view class="check-wrapper" id="checkShop{{vendor.vendorId}}" data-shopid="{{vendor.vendorId}}" bindtap="selectGroup">
                                <text id="checkShop{{vendor.vendorId}}" class="cart-checkbox check-wrapper-unit {{vendor.checkedStatus}}" data-shopid="{{vendor.vendorId}}"></text>
                            </view>
                            <view class="shop-title-content">
                                <view class="shop-title-icon">
                                    <image wx:if="{{vendor.vendorId=='8888'}}" src="https://st.360buyimg.com/order/images/cart5.0/JDshopTitle.png?v=20170607"></image>
                                    <image wx:else src="https://st.360buyimg.com/order/images/cart5.0/POPshopTitle.png?v=20170607"></image>
                                </view>
                                <text class="shop-title-name" style="max-width: 441px;">{{vendor.shopName}}</text>
                            </view>
                        </view>
                    </view>
                    <!-- the header of shop end-->
                    <!-- the product list of shop begin-->
                    <view class="shp-cart-list">
                        <block wx:for="{{vendor.sorted}}" wx:for-item="sortedItem" wx:key="pureProductFor">
                            <block wx:if="{{sortedItem.itemType==1}}">
                                <!-- itemType=1 -->
                                <view id="product{{sortedItem.item.Id}}" class="li" name="productGroup{{vendor.vendorId}}">
                                    <template is="basicproduct" data="{{...sortedItem.item,isOpenWareWeightShow:selfFreightInfo.isOpenWareWeightShow,shopid:vendor.vendorId,...objTextTemplate,objEditMode:objEditMode,limitBookNum:limitBookNum,limitNotBookNum:limitNotBookNum}}" />
                                    <!-- 延保信息展示 begin -->
                                    <block wx:if="{{cartYanBaoInfo}}">
                                        <view id="givenYanbao{{sortedItem.item.Id}}" class="extended-warranty-area">
                                            <block wx:if="{{sortedItem.item.YbSkus&&sortedItem.item.YbSkus.length>0}}">
                                                <view id="showyanbao{{sortedItem.item.Id}}">
                                                    <view class="shp-cart-gift-list">
                                                        <block wx:for="{{sortedItem.item.YbSkus}}" wx:for-item="yb" wx:key="extendedWarrantyList">
                                                            <view wx:if="{{yb && yb.MainYbSku}}" class="shp-cart-gift-list">{{objTextMain.serviceTxt+yb.MainYbSku.Name}}<text class="i">{{yb.MainYbSku.PriceShow}}</text>
                                                            </view>
                                                        </block>
                                                    </view>
                                                </view>
                                            </block>
                                        </view>
                                    </block>
                                    <!-- 延保信息展示 end -->
                                    <!-- 必赠品 begin -->
                                    <view class="shp-cart-gift-list" wx:if="{{sortedItem.item.Gifts && sortedItem.item.Gifts.length>0}}">
                                        <block wx:for="{{sortedItem.item.Gifts}}" wx:for-item="gift" wx:key="pureProductGiftFor">
                                            <view data-skuid="{{gift.Id}}" bindtap="beWareDetail" wx:if="{{gift.AwardType == 1}}">{{objTextMain.annexTxt+gift.Name}}
                                                <text class="num-cont-show no-pro-color" wx:if="{{gift.stockState==objTextTemplate.noshoppingTxt}}">{{gift.stockState}}</text>
                                                <text class="num-cont-show" wx:else>{{gift.Num}}</text>
                                            </view>
                                            <view data-skuid="{{gift.Id}}" bindtap="beWareDetail" wx:else>{{objTextMain.giftTxt+gift.Name}}
                                                <text class="num-cont-show no-pro-color" wx:if="{{gift.stockState==objTextTemplate.noshoppingTxt}}">{{gift.stockState}}</text>
                                                <text class="num-cont-show" wx:else>{{gift.Num}}</text>
                                            </view>
                                        </block>
                                        <view wx:if="{{sortedItem.item.beanScore}}">{{objTextMain.giftBeanTxt+sortedItem.item.beanScore}}</view>
                                    </view>
                                    <!-- 必赠品 end -->
                                </view>
                            </block>
                            <block wx:elif="{{sortedItem.itemType==4}}">
                                <!-- itemType=4 套装 本期不考虑 -->
                            </block>
                            <block wx:elif="{{sortedItem.itemType==9 || sortedItem.itemType==12}}">
                                <!-- itemType=9/itemType=12 -->
                                <view class="li" id="product10360744644" name="productGroup181375">
                                    <!-- 促销活动语 begin-->
                                    <view class="promotion-space" data-activityid='{{sortedItem.item.promotionId}}' data-skuid='{{sortedItem.item.Skus[0].Id}}' data-canselectpromotions='{{sortedItem.item.Skus[0].canSelectPromotions}}' bindtap='beMSearchPage'>
                                        <view class="icon-condition">
                                            <text class="txt">{{sortedItem.item.suitLabel}}</text>
                                            <text class="promotion-down-arrow-icon"></text>
                                        </view>

                                        <view class="condition-description">
                                            <text class="two-linemax">{{sortedItem.item.STip}}</text>
                                        </view>
                                        <view class="condition-description-tips" wx:if="{{sortedItem.item.fullRefundType != 24}}">
                                            <!-- 暂时不支持去换购 -->
                                            <!-- <block wx:if="{{sortedItem.item.fullRefundType == 24}}">
                                                <text>{{sortedItem.item.entryLabel}}</text>
                                            </block> -->
                                            <block wx:if="{{sortedItem.item.promoCase == true}}">
                                                <text>去凑单</text>
                                            </block>
                                            <block wx:else>
                                                <text>再逛逛</text>
                                            </block>
                                            <text class='condition-link'></text>
                                        </view>
                                    </view>
                                    <!-- 促销活动语 end -->
                                    <!-- 查看赠品、领取赠品、查看换购、重新换购 按钮条 begin -->
                                    <block wx:if="{{sortedItem.item.CanSelectGifts && sortedItem.item.CanSelectGifts.length!=0 && sortedItem.item.CanSelectedGiftNum >0 && sortedItem.item.suitLabel!=objTextMain.additionalBuyTxt}}">
                                        <view class="shop-btn-com promo-spc">
                                            <view id="notGivenGift{{sortedItem.item.Id}}" data-info="'suitid':{{sortedItem.item.Id}},'suitnum':{{sortedItem.item.Num}},'sType':{{sortedItem.item.SType==16?13:sortedItem.item.SType}},'addmoney':{{sortedItem.item.AddMoney}}" data-id="{{sortedItem.item.Id}}"
                                                bindtap="showChooseGifts" class="cart-new-btn">
                                                <text class="right-boundary"></text>
                                                <block wx:if="{{sortedItem.item.AddMoney&&sortedItem.item.AddMoney>0}}">
                                                    <text wx:if="{{sortedItem.item.Gifts && sortedItem.item.Gifts.length>0}}" class="btn-msg-in">重新换购</text>
                                                    <text wx:elif="{{sortedItem.item.promoCase == false}}" class="btn-msg-in">换购商品</text>
                                                    <text wx:else class="btn-msg-in">查看换购</text>
                                                </block>
                                                <block wx:else>
                                                    <text wx:if="{{sortedItem.item.Gifts && sortedItem.item.Gifts.length>0}}" class="btn-msg-in">重新领取</text>
                                                    <text wx:elif="{{sortedItem.item.promoCase == false}}" class="btn-msg-in">领取赠品</text>
                                                    <text wx:else class="btn-msg-in">查看赠品</text>
                                                </block>
                                            </view>
                                        </view>
                                    </block>
                                    <block wx:elif="{{sortedItem.item.SType!=11 && sortedItem.item.suitLabel!=objTextMain.additionalBuyTxt}}">
                                        <view class="shop-btn-com promo-spc">
                                            <view id="notGivenGift{{sortedItem.item.Id}}" data-info="'suitid':{{sortedItem.item.Id}},'suitnum':{{sortedItem.item.Num}},'sType':{{sortedItem.item.SType==16?13:sortedItem.item.SType}},'addmoney':{{sortedItem.item.AddMoney}}" data-id="{{sortedItem.item.Id}}"
                                                class="cart-new-btn disabled-act-btn">
                                                <text class="right-boundary"></text>
                                                <block wx:if="{{sortedItem.item.AddMoney&&sortedItem.item.AddMoney>0}}">
                                                    <text wx:if="{{sortedItem.item.Gifts && sortedItem.item.Gifts.length>0}}" class="btn-msg-in">重新换购</text>
                                                    <text wx:elif="{{sortedItem.item.promoCase == false}}" class="btn-msg-in">换购商品</text>
                                                    <text wx:else class="btn-msg-in">查看换购</text>
                                                </block>
                                                <block wx:else>
                                                    <text wx:if="{{sortedItem.item.Gifts && sortedItem.item.Gifts.length>0}}" class="btn-msg-in">重新领取</text>
                                                    <text wx:elif="{{sortedItem.item.promoCase == false}}" class="btn-msg-in">领取赠品</text>
                                                    <text wx:else class="btn-msg-in">查看赠品</text>
                                                </block>
                                            </view>
                                        </view>
                                    </block>
                                    <!-- 查看赠品、领取赠品、查看换购、重新换购 按钮条 end -->
                                    <!-- 换购子商品，满赠子商品展示 begin -->
                                    <block wx:if="{{sortedItem.item && (sortedItem.item.AddMoney || sortedItem.item.AddMoney==0)}}">
                                        <!-- 满赠、换购商品展示 begin -->
                                        <view id="givenGift{{sortedItem.item.Id}}" class="shp-cart-sub-produ-list clear">
                                            <block wx:for="{{sortedItem.item.Gifts}}" wx:for-item="g" wx:key="giftForConsumption">
                                                <view class="items">
                                                    <view class="shp-cart-item-core shop-cart-display sub-product-display  {{g.stockState==objTextMain.noshoppingTxt?'cart-noshopping':''}}">
                                                        <view class="cart-product-cell-1 shp-cart-tag-trade" data-skuid="{{g.Id}}" bindtap="beWareDetail">
                                                            <image wx:if="{{g.ImgUrl}}" class="cart-photo-thumb" src="http://img10.360buyimg.com/n7/{{g.ImgUrl}}">
                                                                <text wx:if="{{g.stockState==objTextMain.noshoppingTxt}}" class="i"></text>
                                                            </image>
                                                            <image wx:else class="cart-photo-thumb">
                                                                <text wx:if="{{g.stockState==objTextMain.noshoppingTxt}}" class="i"></text>
                                                            </image>
                                                        </view>
                                                        <view class="cart-product-cell-2">
                                                            <view class="cart-product-name">
                                                                <view data-skuid="{{g.Id}}" bindtap="beWareDetail">
                                                                    <view class="sub-product-name limit-lines">
                                                                        <text wx:if="{{sortedItem.item.AddMoney==0}}" class="icon-condition" id="gift-info-sign"> {{objTextMain.giftOnlyTxt}}</text>
                                                                        <text wx:else class="icon-condition" id="gift-info-sign"> {{objTextMain.additionalBuyTxt}}</text> {{g.Name}}
                                                                    </view>
                                                                </view>
                                                            </view>
                                                            <view class="cart-product-cell-3">
                                                                <text class="shp-cart-item-price" style="line-height: 20px;" id="price{{g.Id}}">{{g.PriceShow}}</text>
                                                            </view>
                                                            <view class="cart-product-cell-5">
                                                                <text class="num-cont-show">{{g.Num}}</text>
                                                                <view class="shop-btn-com">
                                                                    <view class="cart-new-btn" bindtap="deleteGifts" data-info='{"giftid":{{g.Id}},"giftnum":{{g.Num}},"shopid":{{vendor.shopId}},"vendorId":"{{vendor.vendorId}}","suitId":{{sortedItem.item.Id}},"suitNum":{{sortedItem.item.Num}},"giftSType":{{sortedItem.item.SType==16?16:undefined}}}'>
                                                                        <text class="right-boundary"></text>
                                                                        <text class="btn-msg-in">{{objTextMain.deleteTxt}}</text>
                                                                    </view>
                                                                </view>
                                                            </view>
                                                        </view>
                                                    </view>
                                                </view>
                                            </block>
                                        </view>
                                        <!-- 满赠、换购商品展示 end -->
                                    </block>
                                    <!-- 换购子商品，满赠子商品展示 end -->
                                    <!-- sku主商品循环 begin -->
                                    <block wx:for="{{sortedItem.item.Skus}}" wx:for-item="sku" wx:key="suitProductFor">
                                        <template is="complexproduct" data="{{...sku,isOpenWareWeightShow:selfFreightInfo.isOpenWareWeightShow,shopid:vendor.vendorId,suitId:sortedItem.item.Id,suitNum:sortedItem.item.Num,sType:sortedItem.item.SType==16?13:sortedItem.item.SType,...objTextTemplate,objEditMode:objEditMode,limitBookNum:limitBookNum,limitNotBookNum:limitNotBookNum}}"
                                        />
                                        <!-- 延保信息展示 begin -->
                                        <block wx:if="{{cartYanBaoInfo}}">
                                            <view id="givenYanbao{{sortedItem.item.Id+sku.Id}}" class="extended-warranty-area">
                                                <block wx:if="{{sku.YbSkus&&sku.YbSkus.length>0}}">
                                                    <view id="showyanbao{{sortedItem.item.Id+sku.Id}}">
                                                        <view class="shp-cart-gift-list">
                                                            <block wx:for="{{sku.YbSkus}}" wx:for-item="yb" wx:key="extendedWarrantyList">
                                                                <view wx:if="{{yb && yb.MainYbSku}}" class="shp-cart-gift-list">{{objTextMain.serviceTxt+yb.MainYbSku.Name}}<text class="i">{{yb.MainYbSku.PriceShow}}</text>
                                                                </view>
                                                            </block>
                                                        </view>
                                                    </view>
                                                </block>
                                            </view>
                                        </block>
                                        <!-- 延保信息展示 end -->
                                        <!-- 必赠品 begin -->
                                        <view class="shp-cart-gift-list" wx:if="{{sku.Gifts && sku.Gifts.length>0}}">
                                            <block wx:for="{{sku.Gifts}}" wx:for-item="gift" wx:key="suitProductGiftFor">
                                                <view data-skuid="{{gift.Id}}" bindtap="beWareDetail">{{objTextMain.giftTxt+gift.Name}}
                                                    <text class="num-cont-show no-pro-color" wx:if="{{gift.stockState==objTextTemplate.noshoppingTxt}}">{{gift.stockState}}</text>
                                                    <text class="num-cont-show" wx:else>{{gift.Num}}</text>
                                                </view>
                                            </block>
                                            <view wx:if="{{sku.beanScore}}">{{objTextMain.giftBeanTxt+sku.beanScore}}</view>
                                        </view>
                                        <!-- 必赠品 end -->
                                    </block>
                                    <!-- sku主商品循环 end -->
                                </view>
                            </block>
                        </block>
                    </view>
                    <!-- the product list of shop end-->
                </view>

            </block>
        </view>

        <view id="payment_p" style="display:{{(Num&&Num>0)?'block':'none'}};">
            <view id="paymentp"></view>
            <view class="payment-total-bar payment-total-bar-new box-flex-f" id="payment">
                <view class="shp-chk shp-chk-new  box-flex-c" data-checktype="{{checkedWareNum==Num?'all':'notall'}}" bindtap="checkAllHandler">
                    <text class="cart-checkbox {{checkedWareNum==Num?'checked':''}}" id="checkIcon-1"></text>
                    <text class="cart-checkbox-text">{{objTextMain.allCheckTxt}}</text>
                </view>
                <view class="shp-cart-info shp-cart-info-new  box-flex-c">
                    <view id="shpCartTotal" data-fsizeinit="14" class="shp-cart-total">{{objTextMain.sumTxt}}<text class="bottom-bar-price" id="cart_realPrice"> {{PriceShow}}</text>
                    </view>
                    <view id="saleOffNew" data-fsizeinit="10" class="sale-off sale-off-new  bottom-total-price">{{objTextMain.allCountTxt}}<text class="money-unit-bf" id="cart_oriPrice">{{Price}}</text>{{objTextMain.minusTxt}}<text class="money-unit-bf" id="cart_rePrice">{{RePrice}}</text>
                    </view>
                </view>
                <view class="btn-right-block btn-right-block-new  box-flex-c" id="submit" bindtap="{{checkedWareNum && checkedWareNum>0?'submitFn':''}}">{{objTextMain.goCheckTxt}}<text id="checkedNum">({{(checkedWareNum && checkedWareNum>99)?'99+':checkedWareNum}})</text></view>
            </view>
        </view>
    </block>
    <image class="bottom-to-top" src="http://commonst.360buyimg.com/common/wx-images/scroll-to-top-icon.png" style="display:{{toTopDisplay}}" bindtap="toTopTap"></image>
</scroll-view>

<template wx:if="{{isGiftWinShow}}" is="giftproduct" data="{{...giftData,...objTextGift,...heightInfo}}" />